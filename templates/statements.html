<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Permission Requests</title>
<style>
* {
  margin:0;
  padding:0;
  box-sizing:border-box;
}
body {
  display:flex;
  min-height:100vh;
  font-family:'Roboto', sans-serif;
  background:#f4f5f7;
  color:#333;
}
.sidebar {
  width:240px;
  background:#2f3640;
  color:#fff;
  display:flex;
  flex-direction:column;
  padding:30px 20px;
  position:fixed;
  top:0;
  left:0;
  height:100%;
}
.sidebar h1 {
  font-size:1.8rem;
  font-weight:700;
  margin-bottom:40px;
  color:#0097e6;
  text-align:center;
}
.nav-links {
  display:flex;
  flex-direction:column;
  gap:15px;
}
.nav-links a {
  display:flex;
  align-items:center;
  gap:10px;
  padding:12px;
  border-radius:8px;
  font-weight:500;
  color:#fff;
  text-decoration:none;
  transition:all 0.2s;
}
.nav-links a:hover {
  background:#0097e6;
}
.nav-links a .material-icons {
  font-size:22px;
}
.main-content-wrapper {
  flex:1;
  display:flex;
  justify-content:center;
  margin-left:240px;
  padding:30px 20px;
}
.main-content {
  width:100%;
  max-width:700px;
}
form {
  background:#fff;
  padding:30px;
  border-radius:12px;
  box-shadow:0 6px 15px rgba(0,0,0,0.1);
  margin-bottom:40px;
  display:flex;
  flex-direction:column;
  gap:20px;
}
form h2 {
  text-align:center;
  color:#007bff;
  margin-bottom:15px;
}
.form-group {
  position:relative;
}
.form-group input,
.form-group select,
.form-group textarea {
  width:100%;
  padding:14px 12px;
  border:1px solid #ccc;
  border-radius:8px;
  font-size:0.95rem;
  outline:none;
  transition:all 0.3s;
}
.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
  border-color:#007bff;
  box-shadow:0 0 8px rgba(0,123,255,0.4);
}
.form-group label {
  position:absolute;
  top:14px;
  left:12px;
  background:#fff;
  padding:0 4px;
  color:#999;
  font-weight:500;
  pointer-events:none;
  transition:0.3s;
}
.form-group input:focus + label,
.form-group input:not(:placeholder-shown) + label,
.form-group select:focus + label,
.form-group select:not([value=""]) + label,
.form-group textarea:focus + label,
.form-group textarea:not(:placeholder-shown) + label {
  top:-10px;
  font-size:0.8rem;
  color:#007bff;
}
form button {
  background:#007bff;
  color:#fff;
  padding:12px 18px;
  font-weight:600;
  border:none;
  border-radius:8px;
  cursor:pointer;
  transition:all 0.3s;
  box-shadow:0 4px 10px rgba(0,123,255,0.3);
  width: 50%;
  margin: 25px auto;
}
form button:hover {
  background:#0056b3;
  transform:translateY(-2px);
  box-shadow:0 6px 14px rgba(0,123,255,0.4);
}
table {
  width:100%;
  border-collapse:collapse;
  background:#fff;
  border-radius:10px;
  overflow:hidden;
  box-shadow:0 4px 12px rgba(0,0,0,0.1);
}
table th, table td {
  padding:12px 15px;
  text-align:left;
  border-bottom:1px solid #eee;
}
table th {
  background:#007bff;
  color:#fff;
  font-weight:600;
}
table tr:hover {
  background:#f1f9ff;
}
.action-btn {
  border:none;
  padding:6px 12px;
  border-radius:6px;
  cursor:pointer;
  font-size:0.9rem;
  margin-right:5px;
}
.update-btn {
  background:#fbc531;
  color:#333;
}
.update-btn:hover {
  background:#e1a500;
}
.delete-btn {
  background:#e84118;
  color:#fff;
}
.delete-btn:hover {
  background:#c23616;
}
@media(max-width:768px) {
  body { flex-direction:column; }
  .sidebar { width:100%; position:relative; margin-bottom:20px; }
  .main-content-wrapper { margin-left:0; padding:20px; justify-content:center; }
  form, table { max-width:100%; }
}

footer {
  text-align: center;
  font-size: 16px;
  color: gray;
}
</style>
</head>
<body>

<aside class="sidebar">
  <h1>Student Info</h1>
  <div class="nav-links">
    <a href="{{ url_for('dashboard') }}"><img src="{{url_for('static',filename='images/dashboard.png')}}" height="24" width="24">Dashboard</a>
    <a href="{{ url_for('pex_requests') }}"><img src="{{url_for('static',filename='images/permission.png')}}" height="24" width="24">Permission</a>
    <a href="{{ url_for('update_account') }}"><img src="{{url_for('static',filename='images/registration.png')}}" height="24" width="24">Registration</a>
    <a href="{{ url_for('statements') }}"><img src="{{url_for('static',filename='images/book.png')}}" height="24" width="24">Statement</a>
    <a href="{{ url_for('select_courses') }}"><img src="{{url_for('static',filename='images/academic.png')}}" alt="" height="24" width="24">Academics</a>
  </div>
</aside>

<div class="main-content-wrapper">
  <div class="main-content">
    <div class="top-bar">
      <div style="font-weight:bold; font-size:1.1rem; margin-bottom: 23px">Welcome, {{ user.username }}!</div>

    <form method="POST" action="{{ url_for('pex_requests') }}">
      <h2>Submit Permission Request</h2>
      <div class="form-group">
        <select name="reason" required>
          <option value="">-- Select Reason --</option>
          <option value="Exam">Exam</option>
          <option value="Postpone Year">Postpone Year</option>
          <option value="Sick">Sick</option>
        </select>
        <label>Reason</label>
      </div>
      <div class="form-group">
        <textarea name="details" rows="4" required placeholder=" "></textarea>
        <label>Details</label>
      </div>
      <button type="submit">Submit Request</button>
    </form>

    <footer>&copy; The University of Tanganyika</footer>
    {% if requests %}
    <table>
      <tr>
        <th>Reason</th>
        <th>Details</th>
        <th>Status</th>
        <th>Created At</th>
        <th>Actions</th>
      </tr>
      {% for req in requests %}
      <tr data-id="{{ req.id }}">
        <td>{{ req.reason }}</td>
        <td>{{ req.details }}</td>
        <td>{{ req.status }}</td>
        <td>{{ req.created_at }}</td>
        <td>
          <button class="action-btn update-btn" onclick="updateRequest({{ req.id }})">Update</button>
          <button class="action-btn delete-btn" onclick="deleteRequest({{ req.id }})">Delete</button>
        </td>
      </tr>
      {% endfor %}
    </table>
    {% endif %}
  </div>
</div>

<script>
function updateRequest(id){
  const newDetails = prompt("Enter new details:");
  if(newDetails){
    fetch(`/update_request/${id}`,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({details:newDetails})
    }).then(res=>location.reload());
  }
}
function deleteRequest(id){
  if(confirm("Are you sure you want to delete this request?")){
    fetch(`/delete_request/${id}`,{method:"POST"}).then(res=>location.reload());
  }
}
</script>

</body>
</html>
