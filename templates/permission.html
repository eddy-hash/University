<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>University Permissions</title>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
/* Base */
* { margin:0; padding:0; box-sizing:border-box; font-family:"Segoe UI", sans-serif; }
body { display:flex; min-height:100vh; background:#f4f5f7; color:#333; }

/* Sidebar */
.sidebar {
    width:260px; background:#2f3640; color:#fff; padding:30px 20px;
    display:flex; flex-direction:column; transition:all 0.3s ease;
}
.sidebar h1 { font-size:1.8rem; font-weight:700; margin-bottom:40px; color:#0097e6; text-align:center; }
.nav-links { display:flex; flex-direction:column; gap:15px; }
.nav-links a {
    display:flex; align-items:center; gap:12px;
    text-decoration:none; padding:12px 18px; border-radius:8px;
    font-weight:500; color:#fff; transition:all 0.2s ease-in-out;
}
.nav-links a:hover { background:#0097e6; color:#fff; }
.nav-links a .material-icons { font-size:24px; }

/* Main */
.main-content { flex:1; padding:30px 40px; position:relative; }

/* Top bar */
.top-bar { display:flex; justify-content:space-between; align-items:center; margin-bottom:30px; }
#current-date { font-size:1.1rem; font-weight:bold; color:#2f3640; }
.logout-btn {
    display:flex; align-items:center; gap:6px;
    background:#e84118; color:#fff; padding:10px 16px;
    border:none; border-radius:6px; cursor:pointer; font-weight:600;
    transition:all 0.2s; outline:none;
}
.logout-btn:hover { background:#c23616; transform:translateY(-2px); }
.logout-btn .material-icons { font-size:20px; }

/* Table */
.table-container {
    background:#fff; padding:20px; border-radius:12px;
    box-shadow:0 6px 18px rgba(0,0,0,0.1);
    max-width:1000px; margin:auto; overflow-x:auto;
}
table { width:100%; border-collapse:collapse; }
th, td { text-align:left; padding:12px 15px; border-bottom:1px solid #ccc; }
th {
    background:#0097e6; color:#fff; font-weight:600;
    text-transform:uppercase; font-size:0.9rem;
}
td { background:#f9f9f9; }

/* Buttons */
.delete-btn {
    background:#e84118; color:#fff; border:none;
    padding:6px 12px; border-radius:6px;
    cursor:pointer; transition:all 0.2s ease; outline:none;
}
.delete-btn:hover { background:#c23616; }

/* Profile */
.profile-img {
    width:100px; height:100px; border-radius:50%; object-fit:cover;
    margin-bottom:15px; box-shadow:0 4px 12px rgba(0,0,0,0.3);
}

/* Responsive */
@media(max-width:900px){
    body { flex-direction:column; }
    .sidebar { width:100%; position:absolute; top:0; left:-100%; height:100%; z-index:1000; }
    .sidebar.active { left:0; }
    .main-content { padding:20px; }
    .table-container { max-width:100%; }
}
</style>
</head>
<body>

<!-- Sidebar -->
<aside class="sidebar">
    <h1>Student Info</h1>
    <div class="nav-links">
        <a href="{{ url_for('dashboard') }}"><span class="material-icons">dashboard</span> Dashboard</a>
        <a href="{{ url_for('pex_requests') }}"><span class="material-icons">assignment</span> Permission</a>
        <a href="{{ url_for('registration') }}"><span class="material-icons">how_to_reg</span> Registration</a>
        <a href="{{ url_for('statements') }}"><span class="material-icons">receipt_long</span> Statements</a>
        <a href="{{ url_for('my_room') }}"><span class="material-icons">meeting_room</span> My Room</a>
    </div>
</aside>

<!-- Main content -->
<div class="main-content">

    <!-- Top bar -->
    <div class="top-bar">
        <div id="current-date"></div>
        <form  action="{{ url_for('statements') }}" method="POST">
            <button class="logout-btn"><span class="material-icons">power_settings_new</span> Logout</button>
        </form>
    </div>

    <h2 style="margin-bottom:20px;">Permission Requests</h2>

    <!-- Profile image -->
    <div style="text-align:center; margin-bottom:20px;">
        <img src="{{ url_for('static', filename='images/profile_image.jpeg') }}" class="profile-img" alt="Profile Image">
    </div>

    <!-- Permission table -->
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Reason</th>
                    <th>Details</th>
                    <th>Status</th>
                    <th>Submitted</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for request in user_requests %}
                <tr data-id="{{ request.id }}">
                    <td>{{ request.id }}</td>
                    <td>{{ request.reason }}</td>
                    <td>{{ request.details }}</td>
                    <td>{{ request.status }}</td>
                    <td>{{ request.created_at }}</td>
                    <td>
                        <button type="button" class="delete-btn" onclick="deleteRequest({{ request.id }})">Delete</button>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="6" style="text-align:center;">No permission requests found.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
function deleteRequest(id) {
    if (confirm("Are you sure you want to delete this request?")) {
        fetch(`/delete_permission/${id}`, {
            method: "POST",
            headers: { "Content-Type": "application/json" }
        })
        .then(response => {
            if (response.ok) {
                const row = document.querySelector(`tr[data-id='${id}']`);
                if (row) row.remove();
                alert("Permission request deleted successfully!");
            } else {
                alert("Failed to delete the request.");
            }
        })
        .catch(error => console.error('Error:', error));
    }
}

function updateDate() {
    const now = new Date();
    const day = now.getDate();
    const suffix = (d => d+((d%10==1 && d!=11)?"st":(d%10==2 && d!=12)?"nd":(d%10==3 && d!=13)?"rd":"th"))(day);
    const months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
    const weekday = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
    document.getElementById('current-date').textContent =
        `${suffix} ${weekday[now.getDay()]}, ${months[now.getMonth()]} ${now.getFullYear()}`;
}
updateDate();
</script>

</body>
</html>
